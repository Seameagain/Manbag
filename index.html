<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Marketplace</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1 id="welcome">กำลังโหลด...</h1>
<div id="products"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabase.createClient(
  "https://azmodrfrleszxxqrihfu.supabase.co",
  "PASTE_ANON_PUBLIC_KEY"
);

async function init() {
  try {
    const { data } = await supabase.auth.getSession();

    if (!data.session) {
      document.getElementById("welcome").innerText = "กรุณาเข้าสู่ระบบก่อน";
      return;
    }

    const user = data.session.user;
    document.getElementById("welcome").innerText =
      `สวัสดีคุณ ${user.user_metadata.full_name || user.email} ซื้ออะไรดี`;

    loadProducts();
  } catch (err) {
    console.error("Supabase error:", err.message);
    document.getElementById("welcome").innerText =
      "เกิดข้อผิดพลาด ลอง refresh";
  }
}

async function loadProducts() {
  const { data, error } = await supabase
    .from("products")
    .select("*");

  if (error) {
    document.getElementById("products").innerText = error.message;
    return;
  }

  document.getElementById("products").innerHTML =
    data.map(p => `
      <div class="card">
        <h3>${p.title}</h3>
        <p>${p.description}</p>
        <p>${p.price} บาท</p>
      </div>
    `).join("");
}

init();
</script>

</body>
</html>
